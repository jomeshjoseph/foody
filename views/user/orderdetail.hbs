<div class="container-xxl py-5 px-5">
  <div class="container">
    <div class="row g-0 gx-5 align-items-end">
      <div class="col-lg-6">
        <div class="section-header text-start mb-3 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;">
          <h1 class="display-5 mb-3">Order Summary</h1>
          <p>Tempor ut dolore lorem kasd vero ipsum sit eirmod sit. Ipsum diam justo sed rebum vero dolor duo.</p>
        </div>
      </div>

<!-- Table Start -->

<div class="content">
  <div class="container-fluid pt-2 px-4">
     <div class="col-sm-12 col-xl-12">
       <div class="card-group" >
      
         
          <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-start px-2 pt-2">
           
           <button id="remove-order" onclick="changeStatus('{{allorders._id}}')" class="btn btn-danger">cancel order</button>
          </div>

          </div>
        </div>

           <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-center px-2 pt-2">
           
          <button id="return-order" onclick="returnOrder('{{allorders._id}}')" class=" btn btn-danger">Return</button>
          </div>

          </div>
        </div>
      
         <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-end px-2 pt-2">
           
         <a class="btn btn-success" onclick="generatePDF()">Invoice</a>
          </div>

          </div>
        </div>
        </div>
          <div id="invoice">
            <div class="card-group">
        <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-start px-2 pt-2">
           <p class="text-dark px-2 mb-0">Order Number : {{allorders._id}}</p>
          </div>

          </div>
        </div>
         <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-center px-2 pt-2">
           <p class="text-dark mb-0">{{allorders.date}}</p>
          </div>

          </div>
        </div>
        <div class="col-sm-12 col-xl-4">
          <div class="card-body p-2">
             <div class="d-flex justify-content-end px-2 pt-2">
           <p class="text-dark mb-0"> Order status:{{allorders.status}}</p>
          </div>

          </div>
        </div>
       </div>
     
    
    <div class="row g-1">
      
     <div class="col-sm-12 col-xl-12">
  <div class="bg-white rounded h-100 border border-success" >
    <div class="card-group" >
      <div class="col-sm-12 col-xl-4">
        <div class="card-body p-2">
          <div class="d-flex justify-content-start px-2 pt-2">
            <p class="fw-bold text-dark mb-0">Shipping Addres</p>
          </div>
      
           <div>
      <p class="d-flex justify-content-start px-2 pt-2 me-4 mb-0 text-capitalize"> {{allorders.deliverydetails.firstname}} </p>
      <p class="d-flex justify-content-start me-4 px-2 mb-0 text-capitalize " > {{allorders.deliverydetails.address}} </p>
      <p class="d-flex justify-content-start me-4 px-2 mb-0"> {{allorders.deliverydetails.pincode}} </p>
      </div>
        </div>
      </div>
      <div class="col-sm-12 col-xl-4">
        <div class="card-body p-2">
          <div class="d-flex justify-content-center px-2 pt-2">
            <p class="fw-bold text-dark mb-0">Payment Method</p>
          </div>
          <div class="d-flex justify-content-center px-2 pt-2">
            <p class="text-dark mb-0">{{allorders.paymentmethod}}</p>
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-xl-4">
  <div class="card-body p-2">
    <div class="d-flex justify-content-end px-2 pt-2">
      <p class="fw-bold text-dark mb-0">Order Summary</p>
    </div>
    <div>
      <p class="d-flex justify-content-end px-2 pt-2 mb-0">
        <span class="fw-bold me-4 mb-0">Sub Total</span>
        Rs. {{allorders.totalAmount}}
      </p>
      <p class="d-flex justify-content-end px-2 mb-0">
        <span class="fw-bold me-4 mb-0">Shipping</span>
        Rs. 00.00
      </p>
      <p class="d-flex justify-content-end px-2">
        <span class="fw-bold me-4">Discount</span>
        Rs. 00.00
      </p> 
    </div>
  </div>
</div>

    </div>

    <div class="card-footer border-0 px-4 py-3" style="background-color: #089e14; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
      <h5 class="d-flex align-items-center justify-content-end text-white text-uppercase mb-0">Total paid: <span class="h2 mb-0 ms-2">â‚¹ {{allorders.totalAmount}}</span></h5>
    </div>
  </div>
</div>
<div class="col-sm-12 col-xl-12 pt-2">
  <div class="bg-white rounded h-100 border border-success">
    <div class="product-item pt-2 px-2">
      <div class="tab-content">
        <div>
          <div class="row g-2"> {{#each orderProduct}} 
            <div class="col-xl-3 col-lg-4 col-md-6">
              <div class="product-item ">
                <div class="bg-white rounded border border-white  shadow ">
                  <a href=""> <img class="img-fluid" src="/pro-images/{{this.product.image.[0]}}" alt="" ></a>

                </div>
                 <div class="bg-white rounded h-20 border border-success text-center ">
                  <a class="d-flex bg-success text-white justify-content-center h-2 fw-bold px-2 pt-2 mb-0">
       
        {{this.product.productname}}
      </a>
                </div>
                 <div class="text-center rounded">
                  <a class="d-flex justify-content-center h-2 fw-bold px-2 pt-2 mb-0">
       
        {{this.quantity}}
      </a>
                </div>
               
              </div>
             
            </div> {{/each}} </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
  </div>
  </div>
</div>
</div>
</div>
</div>
<script>



  function deliveryStatusUpdate(value, orderId) {

    $.ajax({
      url: '/admin/order-status',
      data: {
        order: orderId,
        valueChange: value
      },
      method: 'POST',
      success: function (response) {
        Swal.fire(
          'Good job!',
          'Order status Changed!',
          'success'
        ).then(function () {
          location.reload();
        });
      }
    });


  }

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  async function returnOrder(ordId) {
    console.log(ordId , "ordid")
    var returnReason


    await (async () => {

      /* inputOptions can be an object or Promise */
      const inputOptions = new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            'I Changed My Mind': 'I Changed My Mind',
            'High Shipping Cost': 'High Shipping Cost',
            'I Bought The Wrong Item(s)': 'I Bought The Wrong Item(s)',
            'I Found A Cheper Alternative': 'I Found A Cheper Alternative',
            'I Placed A Duplicate Order': 'I Placed A Duplicate Order',
            'Delivery Takes Too Long': 'Delivery Takes Too Long',
            'Other': 'Other'
          })
        }, 1000)
      })

      const { value: color } = await Swal.fire({
        title: 'Choose The Reason For Return Product.',
        width:800,
        padding:'5em',
        input: 'radio',
        inputOptions: inputOptions,
        inputValidator: (value) => {
          if (!value) {
            return 'You need to choose something!'
          }
        }
      })

      if (color) {
        returnReason = color
        console.log(color);
        // Swal.fire({ html: `You selected: ${color}` })
        (async () => {
          const { value: text } = await Swal.fire({
            position: 'center',
            icon: 'success',
            title: 'Your Order Is returned Successfully',
            showConfirmButton: true,
            timer: 3000
          })
          if (text) {
            console.log(text);
          }
        })();


        $.ajax({
          url: `/returnorder/${ordId}`,
          method: 'POST',
          data: {
            returnReason: returnReason
          },
          success: (response) => {
            location.reload()

            console.log("response")
          }
        })

      }

    })()


  }
</script>
<script>
  async function changeStatus(ordId) {
    console.log(ordId , "ordid")
    var reason
    


    await (async () => {

      /* inputOptions can be an object or Promise */
      const inputOptions = new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            'I Changed My Mind': 'I Changed My Mind',
            'High Shipping Cost': 'High Shipping Cost',
            'I Bought The Wrong Item(s)': 'I Bought The Wrong Item(s)',
            'I Found A Cheper Alternative': 'I Found A Cheper Alternative',
            
          })
        }, 1000)
      })

      const { value: color } = await Swal.fire({
        title: 'Choose The Reason.',
        input: 'radio',
        inputOptions: inputOptions,
        inputValidator: (value) => {
          if (!value) {
            return 'You need to choose something!'
          }
        }
      
      })

      if (color) {
        reason = color
        console.log(color);
        // Swal.fire({ html: `You selected: ${color}` })
         await Swal.fire({
            position: 'center',
            icon: 'success',
            title: 'Your Order Is Cancelled Successfully',
            showConfirmButton: false,
            timer: 1500
          })
        


        $.ajax({
          url: `/placedordercancel/${ordId}`,
          method: 'POST',
          data: {
            reason: reason
          },
          success: (response) => {
             location.href='/orderlist'

            console.log("response")
          }
        })

      }

    })()


  }
</script>
<script>
    function generatePDF() {
      const element = document.getElementById('invoice');
      element.style.width = '1000px';
      element.style.height = '700px';
      let opt = {
        margin: 10,
        filename: 'Order-Report.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 1 },
        jsPDF: { unit: 'mm', orientation: 'landscape' }
      }
      html2pdf().set(opt)
        .from(element)
        .save();
    }
</script>